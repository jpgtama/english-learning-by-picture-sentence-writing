<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="css/vendor/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/index.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <!--<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>-->
    <!--<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>-->
    <![endif]-->

    <style>
        .chinese-english-sentence-widget textarea{
            width: 90%;
        }
        .chinese-english-sentence-widget .chinese:before{
            content: 'Ch';
            vertical-align: top;
        }

        .chinese-english-sentence-widget .english:before{
            content: 'En';
            vertical-align: top;
        }

        .chinese-english-sentence-widget .operation-remove{
            cursor: pointer;
        }

        .chinese-english-sentence-widget .operation-remove:hover{
            background-color: #9d9d9d;
            color: white;
        }

        .chinese-english-sentence-widget .operation-add{
            text-align: center;
            cursor: pointer;
        }

        .chinese-english-sentence-widget .operation-add:hover{
            background-color: #9d9d9d;
            color: white;
        }

    </style>

</head>
<body class="container-fluid">

<table class="table table-striped chinese-english-sentence-widget">
    <thead>
    <tr>
        <th>#</th>
        <th>句子</th>
        <th>操作</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <th scope="row" class="index-number">1</th>
        <td>
            <div class="chinese">
                <textarea >周六阳光明媚</textarea>
            </div>
            <div class="english">
                <textarea >It's sunny on Saturday</textarea>
            </div>
        </td>
        <td>
            <span class="operation-remove" >Remove</span>
        </td>
    </tr>
    <tr>
        <th scope="row" class="index-number">2</th>
        <td>
            <div>
                <div class="chinese">
                    <textarea >适合去外面游玩</textarea>
                </div>
                <div class="english">
                    <textarea >It's suitable to go outside and play.</textarea>
                </div>

            </div>
        </td>
        <td>
            <span class="operation-remove">Remove</span>
        </td>
    </tr>
    <tr>
        <th scope="row" class="index-number">3</th>
        <td>
            <div>
                <div class="chinese">
                    <textarea >去公园是一个不错的选择</textarea>
                </div>
                <div class="english">
                    <textarea >It's a good option to go to park.</textarea>
                </div>
            </div>
        </td>
        <td>
            <span class="operation-remove">Remove</span>
        </td>
    </tr>
    <tr>
        <th scope="row" class="index-number">4</th>
        <td>
            <div>
                <div class="chinese">
                    <textarea >我们去了黄兴公园</textarea>
                </div>
                <div class="english">
                    <textarea >We went to HuangXing Park.</textarea>
                </div>
            </div>
        </td>
        <td>
            <span class="operation-remove">Remove</span>
        </td>
    </tr>

    </tbody>

    <tfoot>
        <tr>
            <td colspan="3" class="operation-add">
                Add
            </td>
        </tr>
    </tfoot>

</table>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="css/vendor/bootstrap-3.3.7-dist/js/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="css/vendor/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>


<script>

    class ChineseEnglishSentenceWidget{
        constructor(rootDom){
            this.rootDom = rootDom;
            this.enableRemoveOperation();
            this.enableAddOperation();
        }

        getContentRowTemplate(chinese, english){
            var templateStr =  `    <tr>
                <th scope="row" class="index-number"></th>
                <td>
                    <div>
                        <div class="chinese">
                            <textarea >${chinese}</textarea>
                        </div>
                        <div class="english">
                            <textarea >${english}</textarea>
                        </div>
                    </div>
                </td>
                <td>
                    <span class="operation-remove">Remove</span>
                </td>
            </tr>`;

            var div = document.createElement('table');
            div.innerHTML = templateStr;
            var result = div.querySelector('tr');
            result.parentElement.removeChild(result);
            return result;
        }

        get contentBody(){
            return this.rootDom.querySelector('tbody');
        }

        get contentTRs(){
            return this.rootDom.querySelectorAll('tbody tr');
        }

        get indexNumberDoms(){
            return this.rootDom.querySelectorAll('tbody .index-number');
        }

        getAncestor(dom, isAncestor){
            var check = p => {

                if(!p){
                    return undefined;
                }

                if(isAncestor(p)){
                    return p;
                }else{
                    return check(p.parentElement);
                }
            };

            return check(dom.parentElement);
        }

        enableAddOperation(){
            this.rootDom.querySelector('.operation-add').addEventListener('click', e =>{
                    var rowTemplate = this.getContentRowTemplate('', '');
                    this.contentBody.appendChild(rowTemplate);
                    this.updateIndexNumber();
            });
        }

        enableRemoveOperation(){
            this.rootDom.addEventListener('click', e => {
                if(e.target.classList.contains('operation-remove')){
                    var confirm = window.confirm('Are you sure?');
                    if(confirm){
                        // remove
                        this.operation_remove(this.getAncestor(e.target, p => { return p.tagName === 'TR'; }));
                    }
                }
            });
        }

        operation_remove(tr){
            tr.parentElement.removeChild(tr);
            this.updateIndexNumber();
        }

        updateIndexNumber(){
            var indexNumber = 1;
            this.indexNumberDoms.forEach(dom => {
                dom.innerText = indexNumber++;
            });
        }

        static parse(){
            document.querySelectorAll('.chinese-english-sentence-widget').forEach(dom => {
                var widget = new ChineseEnglishSentenceWidget(dom);
                if(!ChineseEnglishSentenceWidget.widgetList){
                    ChineseEnglishSentenceWidget.widgetList = [];
                }

                ChineseEnglishSentenceWidget.widgetList.push(widget);

                });
        }

        static list(){
            return ChineseEnglishSentenceWidget.widgetList;
        }
    }


    ChineseEnglishSentenceWidget.parse();

</script>

</body>
</html>
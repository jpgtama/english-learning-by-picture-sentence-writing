{"version":3,"sources":["widgets.js"],"names":[],"mappings":"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","file":"widgets-compiled.js","sourcesContent":["\r\nclass ImageUploadWidget{\r\n\r\n\r\n    constructor(rootDom){\r\n        this.rootDom = rootDom;\r\n        // get img dom\r\n        this.imageDom = this.rootDom.querySelector('img');\r\n        this.fileChooseDom = this.rootDom.querySelector('input[type=file]');\r\n        this.buttonDom = this.rootDom.querySelector('button');\r\n\r\n        this.buttonDom.addEventListener('click', e => {\r\n            this.fileChooseDom.click();\r\n        });\r\n\r\n        this.fileChooseDom.addEventListener('change', e => {\r\n            if(this.fileChooseDom.files.length> 0){\r\n                var reader = new FileReader();\r\n                reader.onload = (e) =>{ this.imageDom.src = e.target.result };\r\n                reader.readAsDataURL(this.fileChooseDom.files[0]);\r\n            }else{\r\n                this.imageDom.src = this.imageDom.getAttribute('data-preview-src');\r\n            }\r\n        });\r\n    }\r\n\r\n    static get rootDomTemplate(){\r\n        var templateStr = `<div class=\"image-uploader-widget\">\r\n                    <div>\r\n                        <img src=\"\" style=\"width: 100%; height: auto;\">\r\n                    </div>\r\n                    <div style=\"text-align: center\">\r\n                        <input type=\"file\" style=\"display: none;\">\r\n                        <button class=\"btn btn-primary\" >Upload</button>\r\n                    </div>\r\n                </div>`;\r\n\r\n        var div = document.createElement('div');\r\n        div.innerHTML = templateStr;\r\n\r\n        var template = div.querySelector('.image-uploader-widget');\r\n        template.parentElement.removeChild(template);\r\n\r\n        return template;\r\n    }\r\n\r\n    static parse(){\r\n        alert('begin to parse ImageWidget');\r\n\r\n        var testDiv = document.querySelector('#test');\r\n        // testDiv.appendChild(document.createElement('input'));\r\n        testDiv.innerHTML = '<input>';\r\n\r\n\r\n        // replace all data-widget=image-uploader-widget and replace with template\r\n        document.querySelectorAll('[data-widget=image-uploader-widget]').forEach(dom => {\r\n            // get image preview src\r\n            var previewImageSrc = dom.getAttribute('data-preview-src');\r\n\r\n            var template = ImageUploadWidget.rootDomTemplate;\r\n            var img = template.querySelector('img');\r\n            img.setAttribute('data-preview-src', previewImageSrc);\r\n            img.setAttribute('src', previewImageSrc);\r\n\r\n            // replace\r\n            dom.parentElement.insertBefore(template, dom);\r\n            dom.parentElement.removeChild(dom);\r\n        });\r\n\r\n        // find out all image-uploader-widget\r\n        if(!ImageUploadWidget.widgetList){\r\n            ImageUploadWidget.widgetList = [];\r\n        }\r\n        document.querySelectorAll('.image-uploader-widget').forEach(dom => {\r\n            var widget = new ImageUploadWidget(dom);\r\n            ImageUploadWidget.widgetList.push(widget);\r\n        });\r\n    }\r\n\r\n    static list(){\r\n        return ImageUploadWidget.widgetList;\r\n    }\r\n};\r\n\r\nwindow.addEventListener('load', e => {\r\n    ImageUploadWidget.parse();\r\n});\r\n\r\n\r\n\r\n\r\nclass ChineseEnglishSentenceWidget{\r\n    constructor(rootDom){\r\n        this.rootDom = rootDom;\r\n        this.enableRemoveOperation();\r\n        this.enableAddOperation();\r\n    }\r\n\r\n\r\n\r\n    getContentRowTemplate(chinese, english){\r\n        var templateStr =  `    <tr>\r\n                <th scope=\"row\" class=\"index-number\"></th>\r\n                <td>\r\n                    <div>\r\n                        <div class=\"chinese\">\r\n                            <textarea >${chinese}</textarea>\r\n                        </div>\r\n                        <div class=\"english\">\r\n                            <textarea >${english}</textarea>\r\n                        </div>\r\n                    </div>\r\n                </td>\r\n                <td>\r\n                    <span class=\"operation-remove\">Remove</span>\r\n                </td>\r\n            </tr>`;\r\n\r\n        var div = document.createElement('table');\r\n        div.innerHTML = templateStr;\r\n        var result = div.querySelector('tr');\r\n        result.parentElement.removeChild(result);\r\n        return result;\r\n    }\r\n\r\n    get contentBody(){\r\n        return this.rootDom.querySelector('tbody');\r\n    }\r\n\r\n    get contentTRs(){\r\n        return this.rootDom.querySelectorAll('tbody tr');\r\n    }\r\n\r\n    get indexNumberDoms(){\r\n        return this.rootDom.querySelectorAll('tbody .index-number');\r\n    }\r\n\r\n    getAncestor(dom, isAncestor){\r\n        var check = p => {\r\n\r\n            if(!p){\r\n                return undefined;\r\n            }\r\n\r\n            if(isAncestor(p)){\r\n                return p;\r\n            }else{\r\n                return check(p.parentElement);\r\n            }\r\n        };\r\n\r\n        return check(dom.parentElement);\r\n    }\r\n\r\n    enableAddOperation(){\r\n        this.rootDom.querySelector('.operation-add').addEventListener('click', e =>{\r\n            var rowTemplate = this.getContentRowTemplate('', '');\r\n            this.contentBody.appendChild(rowTemplate);\r\n            this.updateIndexNumber();\r\n        });\r\n    }\r\n\r\n    enableRemoveOperation(){\r\n        this.rootDom.addEventListener('click', e => {\r\n            if(e.target.classList.contains('operation-remove')){\r\n                var confirm = window.confirm('Are you sure?');\r\n                if(confirm){\r\n                    // remove\r\n                    this.operation_remove(this.getAncestor(e.target, p => { return p.tagName === 'TR'; }));\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    operation_remove(tr){\r\n        tr.parentElement.removeChild(tr);\r\n        this.updateIndexNumber();\r\n    }\r\n\r\n    updateIndexNumber(){\r\n        var indexNumber = 1;\r\n        this.indexNumberDoms.forEach(dom => {\r\n            dom.innerText = indexNumber++;\r\n        });\r\n    }\r\n\r\n    static get rootDomTemplate(){\r\n        var div = document.createElement('div');\r\n        var templateStr = `<table class=\"table table-striped chinese-english-sentence-widget\">\r\n                <thead>\r\n                <tr>\r\n                    <th>#</th>\r\n                    <th>句子</th>\r\n                    <th>操作</th>\r\n                </tr>\r\n                </thead>\r\n                <tbody>\r\n                </tbody>\r\n                <tfoot>\r\n                    <tr>\r\n                        <td colspan=\"3\" class=\"operation-add\">\r\n                            Add\r\n                        </td>\r\n                    </tr>\r\n                </tfoot>\r\n            </table>`;\r\n\r\n        div.innerHTML = templateStr;\r\n        var table = div.querySelector('table');\r\n        table.parentElement.removeChild(table);\r\n        return table;\r\n    }\r\n\r\n    static parse(){\r\n        // find out all element with 'data-widget=chinese-english-sentence-widget' and replace it with template\r\n        document.querySelectorAll('[data-widget=chinese-english-sentence-widget]').forEach(dom => {\r\n            // replace\r\n            var templateDom = ChineseEnglishSentenceWidget.rootDomTemplate;\r\n            dom.parentElement.insertBefore(templateDom, dom);\r\n            dom.parentElement.removeChild(dom);\r\n        });\r\n\r\n        // parse, create widget instance and associate with root dom\r\n        document.querySelectorAll('.chinese-english-sentence-widget').forEach(dom => {\r\n            var widget = new ChineseEnglishSentenceWidget(dom);\r\n            if(!ChineseEnglishSentenceWidget.widgetList){\r\n                ChineseEnglishSentenceWidget.widgetList = [];\r\n            }\r\n\r\n            ChineseEnglishSentenceWidget.widgetList.push(widget);\r\n        });\r\n    }\r\n\r\n    static list(){\r\n        return ChineseEnglishSentenceWidget.widgetList;\r\n    }\r\n}\r\n\r\nwindow.addEventListener('load', e => {\r\n    ChineseEnglishSentenceWidget.parse();\r\n});\r\n"]}